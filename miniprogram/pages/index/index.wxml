<!--pages/index/index.wxml-->
<view class="container">
  <view class="header">
    <text class="title">全自动高校教师信息系统</text>
  </view>

  <view class="section">
    <view class="section-title admin-title">一键启动全流程爬取</view>
    <view class="section-content">
      <text class="description">输入一个大学的"院系设置"主页面网址。AI将自动分析、生成配方并执行爬虫抓取所有数据。</text>
      
      <view class="input-group">
        <text class="label">大学院系主页 (入口):</text>
        <input 
          class="input" 
          type="text" 
          placeholder="https://www.pku.edu.cn/department.html"
          value="{{masterUrl}}"
          bindinput="onMasterUrlInput"
        />
      </view>

      <view class="warning">
        <text>⚠️ 警告：此过程非常缓慢 (10-20 分钟)，请查看下方状态栏或服务器终端查看进度。</text>
      </view>

      <button 
        class="btn btn-primary" 
        bindtap="startFullAutomation"
        disabled="{{isRunning}}"
        loading="{{isRunning}}"
      >
        🚀 {{isRunning ? '任务运行中...' : '启动全流程自动化'}}
      </button>

      <view class="status {{statusClass}}" wx:if="{{statusMessage}}">
        <text>{{statusMessage}}</text>
      </view>
    </view>
  </view>

  <view class="section">
    <view class="section-title">教师信息列表</view>
    <view class="section-content">
      <view class="list-header">
        <text class="list-count">共 {{totalCount}} 条记录</text>
        <navigator url="/pages/search/search" class="search-link">
          <text>🔍 高级搜索</text>
        </navigator>
      </view>

      <view class="loading" wx:if="{{isLoading}}">
        <text>正在加载数据...</text>
      </view>

      <view class="teacher-list" wx:if="{{!isLoading && teachers.length > 0}}">
        <view class="teacher-card" wx:for="{{teachers}}" wx:key="index">
          <view class="teacher-name">
            <text class="name">{{item.name || 'N/A'}}</text>
            <text class="title">({{item.title || 'N/A'}})</text>
          </view>
          <view class="teacher-info">
            <text class="info-item">🏫 院系: {{item.department || 'N/A'}} - {{item.university || 'N/A'}}</text>
          </view>
          <view class="teacher-info" wx:if="{{item.email}}">
            <text class="info-item">📧 邮箱: {{item.email}}</text>
          </view>
          <view class="teacher-info" wx:if="{{item.research_interests}}">
            <text class="info-item">🔬 研究方向: {{item.research_interests}}</text>
          </view>
          <view class="teacher-link" wx:if="{{item.profile_url}}">
            <view class="link-text" bindtap="openProfileUrl" data-url="{{item.profile_url}}">
              <text>查看个人主页 →</text>
            </view>
          </view>
        </view>
      </view>

      <view class="empty-state" wx:if="{{!isLoading && teachers.length === 0}}">
        <text>暂无数据，请先启动爬虫任务</text>
      </view>

      <view class="load-more" wx:if="{{!isLoading && teachers.length > 0 && hasMore}}">
        <button class="btn btn-load-more" bindtap="loadMoreTeachers" loading="{{isLoadingMore}}">
          {{isLoadingMore ? '加载中...' : '加载更多'}}
        </button>
      </view>
    </view>
  </view>
</view>

